<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç xstats1 –∫–æ–º–∞–Ω–¥—ã - Q3 Server Emulator</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #0f0;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #0f0;
            text-shadow: 0 0 10px #0f0;
        }
        
        .section {
            background: #000;
            border: 2px solid #0f0;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .section h2 {
            color: #ff0;
            margin-top: 0;
        }
        
        button {
            background: #0a0;
            color: #000;
            border: 2px solid #0f0;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-family: inherit;
            font-size: 14px;
            font-weight: bold;
            border-radius: 3px;
            transition: all 0.2s;
        }
        
        button:hover {
            background: #0f0;
            box-shadow: 0 0 10px #0f0;
        }
        
        button:active {
            transform: scale(0.95);
        }
        
        button:disabled {
            background: #333;
            color: #666;
            border-color: #666;
            cursor: not-allowed;
        }
        
        #console {
            background: #000;
            border: 2px solid #0f0;
            padding: 10px;
            height: 400px;
            overflow-y: auto;
            font-size: 12px;
            margin-top: 10px;
        }
        
        .log-entry {
            margin: 2px 0;
            padding: 2px 5px;
        }
        
        .log-server {
            color: #0ff;
        }
        
        .log-client {
            color: #f0f;
        }
        
        .log-xstats {
            color: #ff0;
        }
        
        .log-info {
            color: #0f0;
        }
        
        .log-error {
            color: #f00;
        }
        
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 3px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .status.online {
            background: #0a0;
            color: #000;
        }
        
        .status.offline {
            background: #a00;
            color: #fff;
        }
        
        input, select {
            background: #000;
            color: #0f0;
            border: 2px solid #0f0;
            padding: 5px 10px;
            font-family: inherit;
            margin: 5px;
        }
        
        .info-box {
            background: #002200;
            border-left: 4px solid #0f0;
            padding: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üéÆ –¢–µ—Å—Ç xstats1 –∫–æ–º–∞–Ω–¥—ã</h1>
    
    <div class="section">
        <h2>üìä –°—Ç–∞—Ç—É—Å —ç–º—É–ª—è—Ç–æ—Ä–∞</h2>
        <div>
            <strong>–≠–º—É–ª—è—Ç–æ—Ä:</strong> 
            <span class="status online" id="emulatorStatus">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</span>
        </div>
        <div id="playersInfo">
            <strong>–ò–≥—Ä–æ–∫–∏:</strong> 0
        </div>
        <div id="clientsInfo">
            <strong>–ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã:</strong> 0
        </div>
    </div>
    
    <div class="section">
        <h2>üéØ –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç</h2>
        <div class="info-box">
            –≠—Ç–æ—Ç —Ç–µ—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
            <ol style="margin: 5px 0;">
                <li>–î–æ–±–∞–≤–∏—Ç –∏–≥—Ä–æ–∫–∞ "TestPlayer" (ID: 0)</li>
                <li>–ü–æ–¥–∫–ª—é—á–∏—Ç –∫–ª–∏–µ–Ω—Ç–∞ 0</li>
                <li>–û—Ç–ø—Ä–∞–≤–∏—Ç –∫–æ–º–∞–Ω–¥—É xstats1</li>
            </ol>
        </div>
        <button onclick="quickTest()" id="quickTestBtn">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å –±—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç</button>
    </div>
    
    <div class="section">
        <h2>üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞–º–∏</h2>
        <div>
            <input type="number" id="playerId" placeholder="Player ID" value="0" min="0" max="31">
            <input type="text" id="playerName" placeholder="Player Name" value="TestPlayer">
            <button onclick="addPlayer()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞</button>
        </div>
        <div>
            <input type="number" id="clientId" placeholder="Client ID" value="0" min="0" max="31">
            <button onclick="connectClient()">üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</button>
            <button onclick="disconnectClient()">‚ùå –û—Ç–∫–ª—é—á–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</button>
        </div>
    </div>
    
    <div class="section">
        <h2>üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥</h2>
        <div>
            <strong>xstats1:</strong><br>
            <select id="targetClientId">
                <option value="0">Player 0</option>
                <option value="1">Player 1</option>
                <option value="2">Player 2</option>
            </select>
            ‚Üí
            <select id="requestingClientId">
                <option value="0">Client 0</option>
                <option value="1">Client 1</option>
                <option value="2">Client 2</option>
                <option value="-1">–í—Å–µ–º –∫–ª–∏–µ–Ω—Ç–∞–º</option>
            </select>
            <button onclick="sendXStats1Cmd()">üìä –û—Ç–ø—Ä–∞–≤–∏—Ç—å xstats1</button>
        </div>
        <div style="margin-top: 10px;">
            <strong>–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞:</strong><br>
            <input type="text" id="customCommand" placeholder='print "Hello"' style="width: 300px;">
            <select id="customClientId">
                <option value="0">Client 0</option>
                <option value="1">Client 1</option>
                <option value="-1">–í—Å–µ–º –∫–ª–∏–µ–Ω—Ç–∞–º</option>
            </select>
            <button onclick="sendCustomCommand()">üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
    </div>
    
    <div class="section">
        <h2>üìú –ò—Å—Ç–æ—Ä–∏—è –∫–æ–º–∞–Ω–¥</h2>
        <button onclick="showCommandHistory()">üìã –ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
        <button onclick="clearConsole()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å</button>
    </div>
    
    <div class="section">
        <h2>üíª –ö–æ–Ω—Å–æ–ª—å</h2>
        <div id="console"></div>
    </div>
    
    <script src="modules/q3-server-emulator.js"></script>
    <script>
        let consoleDiv = document.getElementById('console');
        
        function log(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            consoleDiv.appendChild(entry);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }
        
        function updateStatus() {
            if (!window.serverEmulator) return;
            
            const status = document.getElementById('emulatorStatus');
            status.textContent = '–ó–∞–ø—É—â–µ–Ω';
            status.className = 'status online';
            
            const stats = serverEmulator.getStats();
            document.getElementById('playersInfo').innerHTML = 
                `<strong>–ò–≥—Ä–æ–∫–∏:</strong> ${stats.playersCount}`;
            
            const connectedClients = Array.from(serverEmulator.connectedClients);
            document.getElementById('clientsInfo').innerHTML = 
                `<strong>–ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã:</strong> ${connectedClients.length} ${connectedClients.length > 0 ? '[' + connectedClients.join(', ') + ']' : ''}`;
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —ç–º—É–ª—è—Ç–æ—Ä–∞
        window.addEventListener('load', function() {
            setTimeout(() => {
                if (window.serverEmulator) {
                    log('‚úì Q3 Server Emulator –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'info');
                    
                    // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å callback –¥–ª—è –∫–æ–º–∞–Ω–¥
                    setServerCommandCallback(function(command) {
                        log(`Client ${command.clientId} –ø–æ–ª—É—á–∏–ª –∫–æ–º–∞–Ω–¥—É #${command.sequence}`, 'client');
                        log(`‚Üí ${command.command.substring(0, 100)}${command.command.length > 100 ? '...' : ''}`, 'client');
                    });
                    
                    updateStatus();
                    document.getElementById('quickTestBtn').disabled = false;
                } else {
                    log('‚úó –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —ç–º—É–ª—è—Ç–æ—Ä–∞', 'error');
                }
            }, 100);
        });
        
        function quickTest() {
            log('=== –ó–ê–ü–£–°–ö –ë–´–°–¢–†–û–ì–û –¢–ï–°–¢–ê ===', 'info');
            
            // 1. –î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞
            log('1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ TestPlayer (ID: 0)', 'info');
            serverEmulator.addPlayer(0, 'TestPlayer');
            updateStatus();
            
            // 2. –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞
            setTimeout(() => {
                log('2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ 0', 'info');
                serverEmulator.connectClient(0);
                updateStatus();
                
                // 3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å xstats1
                setTimeout(() => {
                    log('3. –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã xstats1', 'info');
                    sendXStats1(0, 0);
                    
                    log('=== –¢–ï–°–¢ –ó–ê–í–ï–†–®–ï–ù ===', 'info');
                    log('‚úì –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã—à–µ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π', 'info');
                }, 200);
            }, 200);
        }
        
        function addPlayer() {
            const id = parseInt(document.getElementById('playerId').value);
            const name = document.getElementById('playerName').value || `Player${id}`;
            
            serverEmulator.addPlayer(id, name);
            log(`‚ûï –î–æ–±–∞–≤–ª–µ–Ω –∏–≥—Ä–æ–∫: ${name} (ID: ${id})`, 'server');
            updateStatus();
        }
        
        function connectClient() {
            const id = parseInt(document.getElementById('clientId').value);
            
            if (!serverEmulator.players.has(id)) {
                log(`‚úó –ò–≥—Ä–æ–∫ ${id} –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –î–æ–±–∞–≤—å—Ç–µ –µ–≥–æ —Å–Ω–∞—á–∞–ª–∞.`, 'error');
                return;
            }
            
            serverEmulator.connectClient(id);
            log(`üîó –ö–ª–∏–µ–Ω—Ç ${id} –ø–æ–¥–∫–ª—é—á–µ–Ω`, 'server');
            updateStatus();
        }
        
        function disconnectClient() {
            const id = parseInt(document.getElementById('clientId').value);
            serverEmulator.disconnectClient(id);
            log(`‚ùå –ö–ª–∏–µ–Ω—Ç ${id} –æ—Ç–∫–ª—é—á–µ–Ω`, 'server');
            updateStatus();
        }
        
        function sendXStats1Cmd() {
            const targetId = parseInt(document.getElementById('targetClientId').value);
            const requestingId = parseInt(document.getElementById('requestingClientId').value);
            
            if (!serverEmulator.players.has(targetId)) {
                log(`‚úó –ò–≥—Ä–æ–∫ ${targetId} –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç`, 'error');
                return;
            }
            
            if (requestingId === -1) {
                log(`üìä –û—Ç–ø—Ä–∞–≤–∫–∞ xstats1 –¥–ª—è –∏–≥—Ä–æ–∫–∞ ${targetId} –≤—Å–µ–º –∫–ª–∏–µ–Ω—Ç–∞–º`, 'xstats');
                sendXStats1(targetId);
            } else {
                log(`üìä –û—Ç–ø—Ä–∞–≤–∫–∞ xstats1 –¥–ª—è –∏–≥—Ä–æ–∫–∞ ${targetId} –∫–ª–∏–µ–Ω—Ç—É ${requestingId}`, 'xstats');
                sendXStats1(targetId, requestingId);
            }
        }
        
        function sendCustomCommand() {
            const command = document.getElementById('customCommand').value;
            const clientId = parseInt(document.getElementById('customClientId').value);
            
            if (!command) {
                log('‚úó –í–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É', 'error');
                return;
            }
            
            if (clientId === -1) {
                log(`üì® –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã –≤—Å–µ–º: ${command}`, 'server');
                sendServerCommandToAll(command);
            } else {
                log(`üì® –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã –∫–ª–∏–µ–Ω—Ç—É ${clientId}: ${command}`, 'server');
                sendServerCommand(clientId, command);
            }
        }
        
        function showCommandHistory() {
            const commands = getServerCommands(20);
            log('=== –ò–°–¢–û–†–ò–Ø –ö–û–ú–ê–ù–î (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 20) ===', 'info');
            commands.forEach(cmd => {
                log(`#${cmd.sequence} ‚Üí Client ${cmd.clientId}: ${cmd.command.substring(0, 80)}`, 'info');
            });
        }
        
        function clearConsole() {
            consoleDiv.innerHTML = '';
            log('‚úì –ö–æ–Ω—Å–æ–ª—å –æ—á–∏—â–µ–Ω–∞', 'info');
        }
    </script>
</body>
</html>




